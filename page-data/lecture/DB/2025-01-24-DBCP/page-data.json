{"componentChunkName":"component---src-templates-lecture-template-tsx","path":"/lecture/DB/2025-01-24-DBCP/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1 id=\"dbcpdatabase-connection-pool\" style=\"position:relative;\"><a href=\"#dbcpdatabase-connection-pool\" aria-label=\"dbcpdatabase connection pool permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DBCP(Database Connection Pool)</h1>\n<p>DB와 백엔드는 <code class=\"language-text\">TCP</code>를 통하여 통신하는데, 이때 커넥션 시작과 종료에 <code class=\"language-text\">3-way handshake</code>와 <code class=\"language-text\">4-way handshake</code>가 발생하여 비용이 많이 든다<br>\n이를 해결하기 위해 미리 커넥션을 만들어두고 필요할 때 사용하는 기술이 <code class=\"language-text\">DBCP</code>이다.</p>\n<p><img src=\"https://github.com/user-attachments/assets/5675368f-23d0-431b-9052-24770a5256cd\" alt=\"Image\">\r\n커넥션 풀에 커넥션들을 미리 맺어두고 필요할때 <code class=\"language-text\">pool</code>에서 커넥션을 가져오고 사용 후 <code class=\"language-text\">pool</code>에 반납</p>\n<h2 id=\"db-설정\" style=\"position:relative;\"><a href=\"#db-%EC%84%A4%EC%A0%95\" aria-label=\"db 설정 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB 설정</h2>\n<ul>\n<li><code class=\"language-text\">max_connections</code> : client와 맺을 수 있는 최대 connection 수</li>\n<li><code class=\"language-text\">wait_timeout</code> : 커넥션이 유지되고 있지만, 아무 요청이 오지않을 때 얼마나 기다리고 <code class=\"language-text\">close</code> 할지 설정\n<ul>\n<li>마지막 요청이후 <code class=\"language-text\">wait_timeout</code> 만큼 요청이 없어도 대기, 시간 지나면 <code class=\"language-text\">close</code></li>\n<li>시간내에 요청이 오면 시간을 0초로 초기화</li>\n<li>백엔드 측의 비정상적인 <code class=\"language-text\">connection</code> 종료나 네트워크 오류에 대한 대응</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"dbcp-설정백엔드측-설정\" style=\"position:relative;\"><a href=\"#dbcp-%EC%84%A4%EC%A0%95%EB%B0%B1%EC%97%94%EB%93%9C%EC%B8%A1-%EC%84%A4%EC%A0%95\" aria-label=\"dbcp 설정백엔드측 설정 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DBCP 설정(백엔드측 설정)</h2>\n<ul>\n<li><code class=\"language-text\">minimumIdle</code> : <code class=\"language-text\">pool</code>에서 유지하는 최소한의 <code class=\"language-text\">idle connection</code> 수\n<ul>\n<li><code class=\"language-text\">pool</code>에서 아무것도 안하고 대기하고 있는 <code class=\"language-text\">connection</code>을 최소 몇개로 할지</li>\n</ul>\n</li>\n<li><code class=\"language-text\">maximumPoolSize</code> : <code class=\"language-text\">pool</code>에서 유지할 수 있는 최대 <code class=\"language-text\">connection</code> 수\n<ul>\n<li><code class=\"language-text\">idle</code>과 <code class=\"language-text\">active</code>를 합쳐서 최대 몇개로 할지</li>\n<li>일반적으로 <code class=\"language-text\">minimumIdle</code>와 같은 값으로 설정</li>\n<li>사용할 백엔드 서버 수를 고려하여 설정정</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p><code class=\"language-text\">minimumIdle</code>와 <code class=\"language-text\">maximumPoolSize</code>의 설정이 충돌할 시에는 <code class=\"language-text\">maximumPoolSize</code>가 우선권을 가진다.<br>\n요청이 많아지면 여유분의 <code class=\"language-text\">minimumIdle</code>를 만들어야하지만<br>\n만약 만들었을때, <code class=\"language-text\">maximumPoolSize</code>를 초과하면 더 만들지 않음.</p>\n</blockquote>\n<ul>\n<li><code class=\"language-text\">maxLifetime</code> : <code class=\"language-text\">pool</code>에서 커넥션 최대 수명\n<ul>\n<li><code class=\"language-text\">idle</code> 상태가 이 시간을 넘기면 바로 <code class=\"language-text\">close</code></li>\n<li><code class=\"language-text\">active</code> 상태로 사용 중이면 <code class=\"language-text\">pool</code>로 반환되고 <code class=\"language-text\">close</code></li>\n<li><code class=\"language-text\">pool</code>로 반환되지 않으면(<code class=\"language-text\">active</code> 이면) <code class=\"language-text\">close</code>되지 않음</li>\n<li><code class=\"language-text\">wait_timeout</code>보다 몇 초 짧게 설정 권장</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p><code class=\"language-text\">maxLifetime</code>이 <code class=\"language-text\">wait_timeout</code>보다 같거나 길면 문제 발생<br>\n<code class=\"language-text\">active</code>이지만 실제로 사용되지 않는(또는 버그로 반환되지 않는) 커넥션은 백엔드에서 <code class=\"language-text\">close</code>되지 않음<br>\n하지만 해당 커넥션은 DB에서 <code class=\"language-text\">wait_timeout</code>에 의해 종료됨<br>\n백엔드에서는 DB에서 종료된 것을 모르고 다시 사용하려 하면 에러 발생</p>\n</blockquote>\n<ul>\n<li><code class=\"language-text\">connectionTimeout</code> : <code class=\"language-text\">pool</code>에서 커넥션을 빌려오는데 최대 대기 시간</li>\n</ul>\n<h1 id=\"백엔드드-성능-테스트와-문제-찾기\" style=\"position:relative;\"><a href=\"#%EB%B0%B1%EC%97%94%EB%93%9C%EB%93%9C-%EC%84%B1%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%99%80-%EB%AC%B8%EC%A0%9C-%EC%B0%BE%EA%B8%B0\" aria-label=\"백엔드드 성능 테스트와 문제 찾기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>백엔드드 성능 테스트와 문제 찾기</h1>\n<ol>\n<li>백엔드 부하 테스트로 <code class=\"language-text\">request per second</code>와 <code class=\"language-text\">avg response time</code> 측정</li>\n<li>해당 지표의 변곡점 찾기</li>\n</ol>\n<blockquote>\n<p>1초당 처리되는 요청이 더 늘어나지 않는다 => 문제 발생<br>\n요청 1개당 처리되는 시간이 급격하게 늘어난다 => 문제 발생</p>\n</blockquote>\n<ol start=\"3\">\n<li>백엔드의 <code class=\"language-text\">CPU</code>와 <code class=\"language-text\">Memory</code> 사용량 확인 => 리소스 사용 높을 시 백엔드 컨테이너 혹은 서버 추가</li>\n<li>DB의 <code class=\"language-text\">CPU</code>와 <code class=\"language-text\">Memory</code> 사용량 확인 => 리소스 사용 높을 시 레플리카, 캐리 레이어(캐시 서버), 샤딩 등</li>\n<li><code class=\"language-text\">thread per request</code>(spring boot 등) 모델 이라면 <code class=\"language-text\">active thread</code> 확인(쓰레드가 모자란지 혹은 너무 많은지)</li>\n<li>DB의 <code class=\"language-text\">active connection</code> 확인(최대 커넥션만큼 다 사용하고 있는지) => <code class=\"language-text\">maximumPoolSize</code>와 <code class=\"language-text\">max_connections</code> 늘리기</li>\n</ol>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#dbcpdatabase-connection-pool\">DBCP(Database Connection Pool)</a></p>\n<ul>\n<li><a href=\"#db-%EC%84%A4%EC%A0%95\">DB 설정</a></li>\n<li><a href=\"#dbcp-%EC%84%A4%EC%A0%95%EB%B0%B1%EC%97%94%EB%93%9C%EC%B8%A1-%EC%84%A4%EC%A0%95\">DBCP 설정(백엔드측 설정)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%B0%B1%EC%97%94%EB%93%9C%EB%93%9C-%EC%84%B1%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%99%80-%EB%AC%B8%EC%A0%9C-%EC%B0%BE%EA%B8%B0\">백엔드드 성능 테스트와 문제 찾기</a></p>\n</li>\n</ul>","frontmatter":{"title":"DBCP","date":"2025년 01월 24일","tags":["CS"]}}}]}},"pageContext":{"slug":"/lecture/DB/2025-01-24-DBCP/","previous":{"fields":{"slug":"/lecture/DB/2025-01-23-DB-분산/"},"frontmatter":{"categories":["DB"],"title":"DB 분산","date":"2025-01-23 18:00:00 +0900","tags":["CS"]}},"next":{"fields":{"slug":"/lecture/DB/2025-01-25-NoSQL/"},"frontmatter":{"categories":["DB"],"title":"NoSQL","date":"2025-01-25 18:00:00 +0900","tags":["CS"]}}}},"staticQueryHashes":[],"slicesMap":{}}